---
title: "Node.jsã‹ã‚‰å‘¨è¾ºã®BLEãƒ‡ãƒã‚¤ã‚¹ã‚’æ¢ã™ã‚µãƒ³ãƒ—ãƒ« ï¼ˆ2021å¹´4æœˆç‰ˆï¼‰" # è¨˜äº‹ã®ã‚¿ã‚¤ãƒˆãƒ«
emoji: "ğŸ’“" # ã‚¢ã‚¤ã‚­ãƒ£ãƒƒãƒã¨ã—ã¦ä½¿ã‚ã‚Œã‚‹çµµæ–‡å­—ï¼ˆ1æ–‡å­—ã ã‘ï¼‰
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢è¨˜äº‹
topics: ["javascript","bluetooth","ble","IoT","Node.js"] # ã‚¿ã‚°ã€‚["markdown", "rust", "aws"]ã®ã‚ˆã†ã«æŒ‡å®šã™ã‚‹
published: true # å…¬é–‹è¨­å®šï¼ˆfalseã«ã™ã‚‹ã¨ä¸‹æ›¸ãï¼‰
---

ã“ã‚“ã«ã¡ã¯ã€n0bisukeã§ã™ã€‚ [#iotlt vol74](https://iotlt.connpass.com/event/207823/) ã§è©±ã‚’ã—ãŸå†…å®¹ã‚’ã¾ã¨ã‚ã¾ã™ã€‚

Qiitaã§æ˜”æ›¸ã„ãŸè¨˜äº‹ãŒã‚ã‚Šã¾ã™ãŒã€2021å¹´ã«ãªã£ã¦ã ã„ã¶çŠ¶æ³ãŒå¤‰ã‚ã£ã¦ããŸã®ã§ãƒªãƒ©ã‚¤ãƒˆã—ã¦ã¿ã¾ã™ã€‚

## noble

Node.jsã‹ã‚‰BLEãƒ‡ãƒã‚¤ã‚¹ã‚’æ‰±ã†éš›ã«ã¯ãƒã‚¹ãƒˆã¨è¨€ã£ã¦ã„ã„ãã‚‰ã„ã‚ˆãä½¿ã‚ã‚Œã¦ã„ãŸãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ã™ã€‚


> å‚è€ƒ: [Node.jsã‹ã‚‰å‘¨è¾ºã®BLEãƒ‡ãƒã‚¤ã‚¹ã‚’æ¢ã™ã‚µãƒ³ãƒ—ãƒ«](https://qiita.com/n0bisuke/items/00503d2b18fc4f413c4e)

åƒ•ã‚‚2016å¹´é ƒã¾ã§ã¯ç¾å½¹ã§ä½¿ã£ã¦ã¾ã—ãŸãŒã€ãã®é ƒã‹ã‚‰æ›´æ–°ãŒã•ã‚Œãªããªã‚Šã€macã®OSã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆãŒã‚ã£ãŸéš›ã«å‹•ä½œã—ãªããªã£ã¦ã—ã¾ã£ã¦ã„ã¾ã—ãŸã€‚

> å‚è€ƒ: [æœ€è¿‘ã®Node.jsã§Bluetoothäº‹æƒ… #iotlt #abandonware](https://speakerdeck.com/n0bisuke2/zui-jin-falsenode-dot-jsdebluetoothshi-qing-number-iotlt-number-abandonware)

## ã‚¢ãƒãƒ³ãƒ€ãƒ³ã‚¦ã‚§ã‚¢ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®noble

ã‚¢ãƒãƒ³ãƒ€ãƒ³ã‚¦ã‚§ã‚¢ã¨ã¯ç®¡ç†è€…ãŒã‚µãƒãƒ¼ãƒˆã—ãªããªã£ãŸã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’æŒ‡ã™ã‚‰ã—ã„ã§ã™ã€‚

> ã‚¢ãƒãƒ³ãƒ€ãƒ³ã‚¦ã‚§ã‚¢ (Abandonware) ã¨ã¯ã€è‘—ä½œæ¨©è€…ãŒæ—¢ã«è²©å£²ã‚’ã‚„ã‚ãŸã‚Šã‚µãƒãƒ¼ãƒˆã—ã¦ã„ãªã„ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã€ã‚ã‚‹ã„ã¯æ§˜ã€…ãªç†ç”±ã«ã‚ˆã‚Šã€èª°ãŒè‘—ä½œæ¨©è€…ã§ã‚ã‚‹ã‹ä¸æ˜ãªã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’æŒ‡ã™ãŸã‚ã«ç”¨ã„ã‚‰ã‚Œã‚‹èªã§ã‚ã‚‹ã€‚
> https://ja.wikipedia.org/wiki/%E3%82%A2%E3%83%90%E3%83%B3%E3%83%80%E3%83%B3%E3%82%A6%E3%82%A7%E3%82%A2

å®šã‹ã§ã¯ç„¡ã„ã§ã™ãŒã€ã“ã†ã„ã£ãŸã‚¢ãƒãƒ³ãƒ€ãƒ³ã‚¦ã‚§ã‚¢ã‚’å¾©æ´»ã•ã›ã‚‹ã‚ˆã†ãªå‹•ãã¨ã—ã¦[abandonware](https://github.com/abandonware/)ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒã‚ã‚‹æ¨¡æ§˜ã§ã™ã€‚

ãªã‚“ã«ã—ã¦ã‚‚æ›´æ–°ãŒã•ã‚Œãªããªã£ã¦ä¹…ã—ã„nobleã‚’ä½¿ãˆã‚‹ã‚ˆã†ã«ã—ã¦ãã‚Œã¦ã‚‹ã®ã¯å¬‰ã—ã„ã§ã™ã­ã€‚

## æ³¨æ„: macä»¥å¤–ã®äººã¯é€šå¸¸ã®nobleã§ã‚‚å•é¡Œç„¡ã„ã‹ã‚‚

ã—ã£ã‹ã‚Šã¨èª¿ã¹ã‚‰ã‚Œã¦ç„¡ã„ã§ã™ãŒã€nobleãŒå‹•ä½œã—ãªã„ã¨ã„ã†è©±é¡Œã¯macã§å‹•ä½œã•ã›ãŸã„å ´åˆã«é™ã‚‹è©±ã‹ã‚‚ã—ã‚Œãšã€Windowsã‚„ãƒ©ã‚ºãƒ‘ã‚¤ä¸Šã§å‹•ä½œã•ã›ãŸã„å ´åˆã¯é€šå¸¸ã®nobleã§ã‚‚å‹•ä½œã™ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

ï¼ˆæ‰‹å…ƒã§æ¤œè¨¼ã§ããªã„ã®ã§ã‹ã‚‚ã—ã‚Œãªã„ãã‚‰ã„ãªè¡¨ç¾ã«ã—ã¦ã„ã¾ã™ã€‚ï¼‰

## æœ€è¿‘ãªç’°å¢ƒã§nobleã‚’ä½¿ã£ã¦ã„ã

### ç’°å¢ƒ

M1ã®Mac Bookã§ã¯ãªã„ã®ã§æœ€æ–°ã§ã¯ãªã„ã§ã™ãŒã€OSã‚„Node.jsã¯æœ€æ–°ã§ã™ã€‚

* Mac Book Pro 2019
* macOS Big Sur
* Node.js 15.14.0

### æº–å‚™

```bash
$ npm init -y
$ npm i @abandonware/noble
```

ã“ã‚Œã ã‘ã§ã™ã€‚

### ã‚³ãƒ¼ãƒ‰

```javascript

'use strict';

const noble = require('@abandonware/noble');
const knownDevices = [];

//discovered BLE device
const discovered = (peripheral) => {
    const device = {
        name: peripheral.advertisement.localName,
        uuid: peripheral.uuid,
        rssi: peripheral.rssi
    };
    knownDevices.push(device);
    console.log(`${knownDevices.length}:${device.name}(${device.uuid}) RSSI${device.rssi}`);
}

//BLE scan start
const scanStart = () => {
    noble.startScanning();
    noble.on('discover', discovered);
}

if(noble.state === 'poweredOn'){
    scanStart();
}else{
    noble.on('stateChange', scanStart);
}
```

### å®Ÿè¡Œ

```bash
$ node app.js
1:<ãƒ‡ãƒã‚¤ã‚¹åç§°>(<UUID>) RSSI-75
2:<ãƒ‡ãƒã‚¤ã‚¹åç§°>(<UUID>) RSSI85
3:<ãƒ‡ãƒã‚¤ã‚¹åç§°>(<UUID>) RSSI-49
ãƒ»
ãƒ»
ãƒ»
```

å•é¡Œãªãå‹•ã„ã¦ãã‚Œã¾ã—ãŸã€‚æ„Ÿå‹•ã§ã™ã€‚

5å¹´ã¶ã‚Šãã‚‰ã„ã«Macã§ã“ã®ã‚³ãƒ¼ãƒ‰ãŒå‹•ãã¾ã—ãŸã€‚

## æ‰€æ„Ÿ

Node.jsã§BLEåˆ¶å¾¡ãŒã§ãã‚‹ã®ã¯ã‚„ã¯ã‚Šã‚„ã‚Œã‚‹ã“ã¨ã®å¯èƒ½æ€§ãŒåºƒãŒã‚Šã¾ã™ã€‚

ãƒ©ã‚ºãƒ‘ã‚¤ã§æ—§å¼ã®nobleã¯å‹•ãã¿ãŸã„ã§ã™ãŒã€æ‰‹å…ƒã®æ¯è‰¦æ©Ÿ(Mac)ã§è©¦ã›ãªã„ã¨ãƒ‡ãƒãƒƒã‚°ãŒã—ã‚“ã©ãã¦Node.jsã‹ã‚‰BLEåˆ¶å¾¡ã¯å°‘ã—è«¦ã‚ã¦ã„ãŸç¯€ãŒã‚ã‚Šã¾ã—ãŸã€‚

ã“ã“æ•°å¹´ã§ãã¦ãªã‹ã£ãŸãƒ•ãƒ©ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç™ºæ•£ã§ãã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

ã“ã†ã„ã£ãŸJavaScriptã§ãƒ‰ãƒ­ãƒ¼ãƒ³åˆ¶å¾¡ãªã©ã‚‚ã¾ãŸã‚„ã‚Œãã†ã§ã™ã€‚ 

> å‚è€ƒ: [ãƒãƒ³ãƒ—ãƒ­ã‚°ãƒ©ãƒã§ã‚‚ã‚³ãƒ”ãƒšã§OKï¼JavaScriptã‚’ä½¿ã£ã¦Droneã‚’é£›ã°ãã†](https://liginc.co.jp/187633)
